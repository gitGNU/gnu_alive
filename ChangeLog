2004-02-17  Joachim Nilsson  <joachim.nilsson@member.fsf.org>

	* configure.in: We want strcasecmp() if not found we use our
	replacement from -lost.

	* lib/Makefile.am (libost_a_SOURCES): New library for stuff not
	on the current platform, lost. Hence the name -lost.

	* lib/strcasecmp.c (strcasecmp): New file, imported from fetchmail-6.2.4.

2004-02-16  Joachim Nilsson  <joachim.nilsson@member.fsf.org>

	* configure.in: Bump verion number.

	* lib/conf/parser.y (log): Add neat log functionality that can be
	turned on with -DDEBUG, --enable-debug.

	* src/config.c (config_load): Don't continue if conf_read_file() fails.

	* lib/conf/tokens.l: Clean up mess when values inside "". 

	(log): Add neat log functionality that can be turned on with
	-DDEBUG, --enable-debug.

	Also, fix missing stuff for "lexer in lexer" while parsing values
	included in ""'s.

	* lib/conf/conf.c (strlndup): Don't overwrite last character of
	string with NUL. Also, make sure we don't try to copy NULL strings.
	
	(conf_set_value): len decremented too much. Make sure to check
	for sane values of len before decrementing it. Also, we cannot
	free value if value has been tampered with, so we save value in
	orig_value and free it instead.

	(conf_read_file): Remove unnecessary yyin, using stdin instead. 
	Plus minor formatting cleanups.


2004-02-10  Joachim Nilsson  <joachim.nilsson@member.fsf.org>

	* lib/conf/conf.c: Add unistd.h, dup() needs it.

	* lib/conf/parser.y: Temporarily revert to non-reentrant yylineno
	behaviour to be able to build on cygwin.

2004-02-09  Joachim Nilsson  <joachim.nilsson@member.fsf.org>

	* lib/conf/conf.c (strlndup): Renamed copy_string() to strlndup().

	(strlncpy): New (still unused) function to replace dangerous strcpy().

2004-01-31  Joachim Nilsson  <joachim.nilsson@member.fsf.org>

	* qadsl.spec.in: Update.

	* qadsl.lsm.in: Update.

	* src/config.c: Update aliases of parameter list and re-add
	"NULL"-termination of list, libconf needed it to not traverse
	into infinity.

	* lib/conf/conf.c (conf_find_key): Fix major bug where a
	parameter_list could be traversed into infinity w/o finding the
	end of the list, even when the list was terminated.

	* lib/conf/conf.c: First effort at making libconf reentrant.

	* lib/conf/parser.y: dito

	* lib/conf/tokens.lo: dito

	* etc/qadsl.conf: Cleanup to comply with specifications in
	src/config.c. Also, fix email address.

2004-01-20  Joachim Nilsson  <joachim.nilsson@member.fsf.org>

	* src/daemon.c (daemon_thread): Major cleanups.

	Make sure we exit the daemon if we cannot create any lockfile - this
	to prevent multiple daemons starting up.

	Check if we're already logged in after pre_login() stage, then we do
	not need to call log_login().

	* src/main.c (main): Fix bogus comment.

	* src/config.c: LOGIN_STRING_HEADER default to NULL instead of "".

	fallback_pid_files[] temporarily stored here. Need a better
	place, not in lock.c though - it is supposed to be agnostic of
	the file name.

	* src/http.c (internet_login): login_string_header might be NULL,
	do not call strlen() with NULL.

	Do not compose a login string of empty parts it might generate
	very bisarre strings, e.g., "?one=1&&three=3&four=4".

	Bogus if() statement checked the wrong pointer, temp instead of
	login_string. 

	Skip url_encode() for now.

	Zero-terminate the read message from the server, needed for
	parsing later to determine if login was successful or not.

	Just return, leave avalutation of result to caller.

	(log_login): Skip internet_login() if pre_login() reveals that
	we're already logged in.
	
	* src/http.c (url_encode): strchr(unsave, s[i]) should suffice as
	the filter to find characters that must be encoded. Otherwise too
	much is encoded and the resulting string is too long and might
	not be possible to parse for the server.

	* src/process.c (process): Cleanup. Everything now done in the
	same switch-case, it might be better. However, fns like
	process_login() and process_logout() might be even better.

	lock_read() and lock_remove() should use whatever main() found
	out and stored in config->pid_file instead of PID_FILE!

	* src/lock.c (lock_create): Added fallback_pid_files[] and minor
	cleanups. The function will alter the @file argument if a
	fallback is used instead of the given one.

	(lock_read): dito. A return value >0 is an OK pid.

2004-01-14  Joachim Nilsson  <joachim.nilsson@member.fsf.org>

	* debian: Added Debian package directory.

2004-01-11  Joachim Nilsson  <joachim.nilsson@member.fsf.org>

	* .: Cleanups and final tests for release 1.3.0
	  This release will be the first with the new
	  code base - to be followed by continous new
	  features.

2003-07-06  Joachim Nilsson  <joachim.nilsson@member.fsf.org>

	* qadsl: initial version.

